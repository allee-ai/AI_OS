# Linear Feeds Source
# Pulls assigned issues, pushes comments

name: linear
type: rest
enabled: false

poll_interval: 300

auth:
  method: bearer
  token_env: LINEAR_API_KEY

# Pull: GraphQL query for assigned issues
pull:
  endpoint: https://api.linear.app/graphql
  method: POST
  body:
    query: |
      query {
        viewer {
          assignedIssues(first: 20, filter: { state: { type: { nin: ["completed", "canceled"] } } }) {
            nodes {
              id
              identifier
              title
              description
              state { name }
              creator { name email }
            }
          }
        }
      }
  
  mapping:
    messages: "$.data.viewer.assignedIssues.nodes"
    id: "$.id"
    thread_id: "$.id"
    sender_id: "$.creator.email"
    sender_name: "$.creator.name"
    subject: "$.title"
    body: "$.description"

# Push: Add comment to issue
push:
  endpoint: https://api.linear.app/graphql
  method: POST
  
  body_template:
    query: |
      mutation {
        commentCreate(input: { issueId: "{{thread_id}}", body: "{{body}}" }) {
          comment { id }
        }
      }
