# WhatsApp Business Feeds Source
# Pulls messages via Cloud API, pushes replies

name: whatsapp
type: rest
enabled: false

poll_interval: 60

auth:
  method: bearer
  token_env: WHATSAPP_TOKEN

# Pull: Webhook receives messages (this is for polling fallback)
pull:
  endpoint: https://graph.facebook.com/v18.0/{{phone_number_id}}/messages
  method: GET
  
  mapping:
    messages: "$.messages"
    id: "$.id"
    thread_id: "$.from"
    sender_id: "$.from"
    sender_name: "$.contacts[0].profile.name"
    subject: null
    body: "$.text.body"

# Push: Send message
push:
  endpoint: https://graph.facebook.com/v18.0/{{phone_number_id}}/messages
  method: POST
  
  body_template:
    messaging_product: "whatsapp"
    recipient_type: "individual"
    to: "{{to}}"
    type: "text"
    text:
      body: "{{body}}"
