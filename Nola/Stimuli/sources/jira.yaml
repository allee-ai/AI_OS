# Jira Stimuli Source
# Pulls assigned issues, pushes comments

name: jira
type: rest
enabled: false

poll_interval: 300

auth:
  method: basic
  # email:api_token
  credentials_env: JIRA_CREDENTIALS
  domain_env: JIRA_DOMAIN  # your-domain.atlassian.net

# Pull: JQL search for assigned issues
pull:
  endpoint: https://{{domain}}/rest/api/3/search
  method: POST
  body:
    jql: "assignee = currentUser() AND status NOT IN (Done, Closed)"
    maxResults: 20
    fields:
      - summary
      - description
      - status
      - creator
      - reporter
  
  mapping:
    messages: "$.issues"
    id: "$.id"
    thread_id: "$.key"
    sender_id: "$.fields.reporter.accountId"
    sender_name: "$.fields.reporter.displayName"
    subject: "$.fields.summary"
    body: "$.fields.description.content[0].content[0].text"

# Push: Add comment
push:
  endpoint: https://{{domain}}/rest/api/3/issue/{{thread_id}}/comment
  method: POST
  
  body_template:
    body:
      type: doc
      version: 1
      content:
        - type: paragraph
          content:
            - type: text
              text: "{{body}}"
